var regeneratorRuntime;
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MPServerless=t():e.MPServerless=t()}(this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./node_modules/@alicloud/mpserverless-core/dist/index.js":function(e,t,r){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"../../node_modules/_process@0.11.10@process/browser.js":function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();function u(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout){r=setTimeout;return setTimeout(e,0)}try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var c,s=[],l=!1,f=-1;function p(){if(l&&c){l=!1;c.length?s=c.concat(s):f=-1;s.length&&d()}}function d(){if(!l){var e=u(p);l=!0;for(var t=s.length;t;){c=s;s=[];for(;++f<t;)c&&c[f].run();f=-1;t=s.length}c=null;l=!1;!function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout){n=clearTimeout;return clearTimeout(e)}try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];s.push(new y(e,t));1!==s.length||l||u(d)};function y(e,t){this.fun=e;this.array=t}y.prototype.run=function(){this.fun.apply(null,this.array)};o.title="browser";o.browser=!0;o.env={};o.argv=[];o.version="";o.versions={};function h(){}o.on=h;o.addListener=h;o.once=h;o.off=h;o.removeListener=h;o.removeAllListeners=h;o.emit=h;o.prependListener=h;o.prependOnceListener=h;o.listeners=function(e){return[]};o.binding=function(e){throw new Error("process.binding is not supported")};o.cwd=function(){return"/"};o.chdir=function(e){throw new Error("process.chdir is not supported")};o.umask=function(){return 0}},"../../node_modules/_util@0.11.1@util/node_modules/inherits/inherits_browser.js":function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype;e.prototype=new r;e.prototype.constructor=e}},"../../node_modules/_util@0.11.1@util/support/isBufferBrowser.js":function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},"../../node_modules/_util@0.11.1@util/util.js":function(e,t,r){(function(e){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++)r[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return r},o=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(u(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,a=String(e).replace(o,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),c=n[r];r<i;c=n[++r])h(c)||!w(c)?a+=" "+c:a+=" "+u(c);return a};t.deprecate=function(r,n){if(void 0!==e&&!0===e.noDeprecation)return r;if(void 0===e)return function(){return t.deprecate(r,n).apply(this,arguments)};var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(n);e.traceDeprecation?console.trace(n):console.error(n);o=!0}return r.apply(this,arguments)}};var i,a={};t.debuglog=function(r){b(i)&&(i=e.env.NODE_DEBUG||"");r=r.toUpperCase();if(!a[r])if(new RegExp("\\b"+r+"\\b","i").test(i)){var n=e.pid;a[r]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",r,n,e)}}else a[r]=function(){};return a[r]};function u(e,r){var n={seen:[],stylize:s};arguments.length>=3&&(n.depth=arguments[2]);arguments.length>=4&&(n.colors=arguments[3]);y(r)?n.showHidden=r:r&&t._extend(n,r);b(n.showHidden)&&(n.showHidden=!1);b(n.depth)&&(n.depth=2);b(n.colors)&&(n.colors=!1);b(n.customInspect)&&(n.customInspect=!0);n.colors&&(n.stylize=c);return l(n,e,n.depth)}t.inspect=u;u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function c(e,t){var r=u.styles[t];return r?"["+u.colors[r][0]+"m"+e+"["+u.colors[r][1]+"m":e}function s(e,t){return e}function l(e,r,n){if(e.customInspect&&r&&j(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var o=r.inspect(n,e);v(o)||(o=l(e,o,n));return o}var i=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return m(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}(e,r);if(i)return i;var a=Object.keys(r),u=function(e){var t={};e.forEach((function(e,r){t[e]=!0}));return t}(a);e.showHidden&&(a=Object.getOwnPropertyNames(r));if(x(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(r);if(0===a.length){if(j(r)){var c=r.name?": "+r.name:"";return e.stylize("[Function"+c+"]","special")}if(g(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(O(r))return e.stylize(Date.prototype.toString.call(r),"date");if(x(r))return f(r)}var s,w="",_=!1,P=["{","}"];if(d(r)){_=!0;P=["[","]"]}j(r)&&(w=" [Function"+(r.name?": "+r.name:"")+"]");g(r)&&(w=" "+RegExp.prototype.toString.call(r));O(r)&&(w=" "+Date.prototype.toUTCString.call(r));x(r)&&(w=" "+f(r));if(0===a.length&&(!_||0==r.length))return P[0]+w+P[1];if(n<0)return g(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);s=_?function(e,t,r,n,o){for(var i=[],a=0,u=t.length;a<u;++a)T(t,String(a))?i.push(p(e,t,r,n,String(a),!0)):i.push("");o.forEach((function(o){o.match(/^\d+$/)||i.push(p(e,t,r,n,o,!0))}));return i}(e,r,n,u,a):a.map((function(t){return p(e,r,n,u,t,_)}));e.seen.pop();return function(e,t,r){return e.reduce((function(e,t){t.indexOf("\n");return e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}(s,w,P)}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,o,i){var a,u,c;(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?u=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(u=e.stylize("[Setter]","special"));T(n,o)||(a="["+o+"]");u||(e.seen.indexOf(c.value)<0?(u=h(r)?l(e,c.value,null):l(e,c.value,r-1)).indexOf("\n")>-1&&(u=i?u.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+u.split("\n").map((function(e){return"   "+e})).join("\n")):u=e.stylize("[Circular]","special"));if(b(a)){if(i&&o.match(/^\d+$/))return u;if((a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){a=a.substr(1,a.length-2);a=e.stylize(a,"name")}else{a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");a=e.stylize(a,"string")}}return a+": "+u}function d(e){return Array.isArray(e)}t.isArray=d;function y(e){return"boolean"==typeof e}t.isBoolean=y;function h(e){return null===e}t.isNull=h;t.isNullOrUndefined=function(e){return null==e};function m(e){return"number"==typeof e}t.isNumber=m;function v(e){return"string"==typeof e}t.isString=v;t.isSymbol=function(e){return"symbol"==typeof e};function b(e){return void 0===e}t.isUndefined=b;function g(e){return w(e)&&"[object RegExp]"===_(e)}t.isRegExp=g;function w(e){return"object"==typeof e&&null!==e}t.isObject=w;function O(e){return w(e)&&"[object Date]"===_(e)}t.isDate=O;function x(e){return w(e)&&("[object Error]"===_(e)||e instanceof Error)}t.isError=x;function j(e){return"function"==typeof e}t.isFunction=j;t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e};t.isBuffer=r("../../node_modules/_util@0.11.1@util/support/isBufferBrowser.js");function _(e){return Object.prototype.toString.call(e)}function P(e){return e<10?"0"+e.toString(10):e.toString(10)}var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(){var e=new Date,t=[P(e.getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":");return[e.getDate(),S[e.getMonth()],t].join(" ")}t.log=function(){console.log("%s - %s",E(),t.format.apply(t,arguments))};t.inherits=r("../../node_modules/_util@0.11.1@util/node_modules/inherits/inherits_browser.js");t._extend=function(e,t){if(!t||!w(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e};function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var k="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(k&&e[k]){var t;if("function"!=typeof(t=e[k]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0});return t}function t(){for(var t,r,n=new Promise((function(e,n){t=e;r=n})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(e,n){e?r(e):t(n)}));try{e.apply(this,o)}catch(e){r(e)}return n}Object.setPrototypeOf(t,Object.getPrototypeOf(e));k&&Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0});return Object.defineProperties(t,n(e))};t.promisify.custom=k;function R(e,t){if(!e){var r=new Error("Promise was rejected with a falsy value");r.reason=e;e=r}return t(e)}t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var o=r.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,a=function(){return o.apply(i,arguments)};t.apply(this,r).then((function(t){e.nextTick(a,null,t)}),(function(t){e.nextTick(R,t,a)}))}Object.setPrototypeOf(r,Object.getPrototypeOf(t));Object.defineProperties(r,n(t));return r}}).call(this,r("../../node_modules/_process@0.11.10@process/browser.js"))},"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"ErrorClass",(function(){return m}));r.d(t,"MPServerlessErrorClass",(function(){return b}));r.d(t,"bizError",(function(){return g}));r.d(t,"assert",(function(){return w}));r.d(t,"camelToLisp",(function(){return O}));r.d(t,"emptyLogger",(function(){return _}));r.d(t,"HTTPMethod",(function(){return x}));r.d(t,"TransportProtocol",(function(){return j}));r.d(t,"SERVERLESS_HEADER_PREFIX",(function(){return S}));r.d(t,"PREFIX",(function(){return P}));r.d(t,"Validator",(function(){return A}));r.d(t,"BaseEncoder",(function(){return F}));r.d(t,"HTTPRequestEncoder",(function(){return H}));r.d(t,"BaseDecoder",(function(){return ee}));r.d(t,"HTTPResponseDecoder",(function(){return te}));r.d(t,"HTTPTransport",(function(){return ie}));r.d(t,"BaseService",(function(){return ue}));r.d(t,"MPServerlessCore",(function(){return le}));r("./src/thirdParty/runtime.es5.js");function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&d(e,t)}function u(e){var t=p();return function(){var r,n=y(e);if(t){var o=y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return c(this,r)}}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?s(e):t}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return f(e,arguments,y(this).constructor)}r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}});return d(r,e)})(e)}function f(e,t,r){return(f=p()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));r&&d(o,r.prototype);return o}).apply(null,arguments)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var m=function(e){a(r,e);var t=u(r);function r(e,n){var o;i(this,r);h(s(o=t.call(this)),"code",void 0);h(s(o),"message",void 0);Error.captureStackTrace&&Error.captureStackTrace(s(o),o.constructor);o.code=o.constructor.code;o.message=o.constructor.prefix;n&&(o.message+=": ".concat(n));e instanceof Error?o.message="".concat(o.message," << ").concat(e.message):"string"==typeof e&&(o.message="".concat(o.message,": ").concat(e));return o}return r}(l(Error));h(m,"code",void 0);h(m,"prefix",void 0);var v=function(){function e(){i(this,e);h(this,"code",void 0);h(this,"message",void 0)}!function(e,t,r){t&&o(e.prototype,t)}(e,[{key:"setCode",value:function(e){this.code=e;return this}},{key:"setMessage",value:function(e){this.message=e;return this}},{key:"build",value:function(){var e,t,r=this.code,n=this.message;return t=e=function(e){a(r,e);var t=u(r);function r(){i(this,r);return t.apply(this,arguments)}return r}(m),h(e,"code",r),h(e,"prefix",n),t}}]);return e}();function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{code:"MPServerlessError",message:"MPServerless Error"},r=new v;return Object.keys(e).reduce((function(n,o){n[o]=r.setCode(e[o].code||t.code).setMessage(e[o].message||t.message).build();return n}),{})}var g=b({ValidationError:{code:"ValidationFailed",message:"参数校验错误"}});function w(e,t){if(!e)throw new g.ValidationError(t)}function O(e){return e.replace(/[A-Z]/g,(function(e){return"-".concat(e.toLowerCase())}))}var x,j,_={log:function(){},info:function(){},warn:function(){},error:function(){},debug:function(){}};!function(e){e.GET="GET";e.DEL="DELETE";e.POST="POST"}(x||(x={}));!function(e){e.HTTP="HTTP"}(j||(j={}));var P,S="x-serverless-";!function(e){e.CLIENT="/client";e.SERVER="/server";e.ANTCLOUD="/antcloud";e.ANTOPENANTCLOUD="/antopen/antcloud"}(P||(P={}));var E=r("./src/thirdParty/parameter.es5.js"),T=r.n(E);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}var A=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);!function(e,t,r){"p"in e?Object.defineProperty(e,"p",{value:r,enumerable:!0,configurable:!0,writable:!0}):e.p=r}(this,0,void 0);this.p=new T.a(t)}!function(e,t,r){t&&R(e.prototype,t)}(e,[{key:"validate",value:function(e,t){if("object"!==k(t)&&"string"==typeof e){t={field:t};e={field:e}}var r=this.p.validate(e,t);if(!r)return null;var n=r.map((function(e){if(e.field){for(var r=JSON.parse(JSON.stringify(t)),n=e.field.match(/[^\.\[\]]+/g);n.length;){var o=n.shift();if(!r.hasOwnProperty(o))break;r=r[o]}e.value=r}return e}));throw new g.ValidationError(function e(t){return Array.isArray(t)?t.map(e).join("; "):"".concat(t.field," ").concat(t.message)}(n))}}]);return e}();function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function L(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?B(e):t}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var F=function e(){U(this,e)},H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&C(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=N(e);if(t){var o=N(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return L(this,r)}}(r);function r(e,n){var o;U(this,r);(o=t.call(this)).endpoint=e;z(B(o),"body",{});z(B(o),"query",{});z(B(o),"method",x.POST);z(B(o),"prefix","");z(B(o),"baseHeaders",{});z(B(o),"serviceHeaders",{});z(B(o),"serverlessHeaders",{});z(B(o),"baseUrl",void 0);n&&(o.prefix=n);return o}!function(e,t,r){t&&M(e.prototype,t)}(r,[{key:"encodeAsHTTPRequestObject",value:function(e){return{url:"",data:{},method:x.POST,headers:{}}}},{key:"sign",value:function(e){}},{key:"url",get:function(){return[this.endpoint+this.prefix].filter((function(e){return!!e})).join("?")}},{key:"headers",get:function(){var e=this,t=Object.keys(this.serverlessHeaders).reduce((function(t,r){t["".concat(S).concat(O(r))]=e.serverlessHeaders[r];return t}),{});return D(D({},this.baseHeaders),t)}},{key:"setBodyField",value:function(e){this.body=Object.assign({},this.body,D({},e));return this}},{key:"setUserId",value:function(e){this.setBodyField({userId:e});return this}},{key:"setBaseHeaders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.baseHeaders=D(D({},this.baseHeaders),Object.keys(e).reduce((function(t,r){e[r]&&(t[r]=e[r].toString());return t}),{}));return this}},{key:"setServerlessHeaders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.serverlessHeaders=D(D({},this.serverlessHeaders),Object.keys(e).reduce((function(t,r){e[r]&&(t[r]=e[r].toString());return t}),{}));return this}},{key:"encode",value:function(){this.body.params&&(this.body.params=JSON.stringify(this.body.params));return{url:this.url,data:this.body,method:this.method,headers:this.headers}}}]);return r}(F);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){X(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function $(e,t){return($=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function K(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?W(e):t}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ee=function e(){Q(this,e)},te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&$(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=Z(e);if(t){var o=Z(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return K(this,r)}}(r);function r(){var e;Q(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];X(W(e=t.call.apply(t,[this].concat(o))),"_body",{});X(W(e),"_error",void 0);X(W(e),"_status",void 0);X(W(e),"_headers",{});return e}!function(e,t,r){t&&J(e.prototype,t)}(r,[{key:"setHeaders",value:function(e){this._headers=V(V({},this._headers),e)}},{key:"setStatusAndBody",value:function(e,t){this._status=e;this._body=t}},{key:"setErrorMessage",value:function(e){this._error=new Error(e)}},{key:"setErrorObject",value:function(e){this._error=e}},{key:"decode",value:function(){return{body:this._body||{},error:this._error,status:this._status,headers:this._headers}}}]);return r}(ee);function re(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function oe(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var ie=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.endpoint=t;oe(this,"authType",void 0);oe(this,"protocol",j.HTTP);oe(this,"logger",void 0);oe(this,"appId",void 0);oe(this,"appSecret",void 0);oe(this,"spaceId",void 0);oe(this,"timeout",void 0);oe(this,"ua",void 0)}!function(e,t,r){t&&ne(e.prototype,t)}(e,[{key:"getEncoder",value:function(e){return new H(this.endpoint,e)}},{key:"setAppId",value:function(e){this.appId=e}},{key:"setAppSecret",value:function(e){this.appSecret=e;return this}},{key:"setUA",value:function(e){this.ua=e;return this}},{key:"setLogger",value:function(e){this.logger=e}},{key:"setTimeout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"5s";if("string"==typeof e){if(e.indexOf("ms")>=0){this.timeout=parseInt(e,10);return}if(e.indexOf("s")>=0){this.timeout=1e3*parseInt(e,10);return}}else if("number"==typeof e){this.timeout=e;return}this.timeout=5e3}},{key:"timeoutOption",get:function(){return this.timeout}},{key:"setSpaceId",value:function(e){this.spaceId=e}},{key:"request",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){re(i,n,o,a,u,"next",e)}function u(e){re(i,n,o,a,u,"throw",e)}a(void 0)}))}}(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(new te).decode());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]);return e}();function ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}var ue=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.transport=t}!function(e,t,r){t&&ae(e.prototype,t)}(e,[{key:"getEncoder",value:function(e){return this.transport.getEncoder(e)}}]);return e}();function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function se(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var le=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);se(this,"options",void 0);se(this,"_debug",void 0);se(this,"_logger",void 0);se(this,"transport",void 0);w(t,"options is required");w(t.spaceId,"spaceId is required");w(t.endpoint,"endpoint is required");this._debug=!1;this._logger=t.logger||_;this.options=t;this.createTransport(t)}!function(e,t,r){t&&ce(e.prototype,t)}(e,[{key:"setDebugFlag",value:function(e){this._debug=e;this.transport.setLogger(this.logger)}},{key:"debug",get:function(){return this._debug}},{key:"logger",get:function(){return this._debug?this._logger:_}},{key:"createTransport",value:function(e){var t=e.httpTransport;this.transport=new t(e.endpoint);this.transport.setAppId(e.appId);this.transport.setLogger(this.logger);this.transport.setSpaceId(e.spaceId);this.transport.setTimeout(e.timeout)}}]);return e}()},"./src/thirdParty/parameter.es5.js":function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}(),i=r("../../node_modules/_util@0.11.1@util/util.js"),a=/^\d{4}\-\d{2}\-\d{2}$/,u=/^\d{4}\-\d{2}\-\d{2} \d{2}:\d{2}:\d{2}$/,c=/^\d+$/,s=/^[a-z0-9\!\#\$\%\&\'\*\+\/\=\?\^\_\`\{\|\}\~\-]+(?:\.[a-z0-9\!\#\$\%\&\'\*\+\/\=\?\^\_\`\{\|\}\~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?$/i,l=/^[\w\`\~\!\@\#\$\%\^\&\*\(\)\-\_\=\+\[\]\{\}\|\;\:\'\"\,\<\.\>\/\?]+$/,f=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/i,p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);"function"==typeof(t=t||{}).translate&&(this.translate=t.translate);t.validateRoot&&(this.validateRoot=!0);t.convert&&(this.convert=!0);t.widelyUndefined&&(this.widelyUndefined=!0)}o(e,[{key:"t",value:function(){var e=Array.prototype.slice.call(arguments);return"function"==typeof this.translate?this.translate.apply(this,e):i.format.apply(i,e)}},{key:"validate",value:function(e,t){if("object"!==(void 0===e?"undefined":n(e)))throw new TypeError("need object type rule");if(this.validateRoot&&("object"!==(void 0===t?"undefined":n(t))||!t))return[{message:this.t("the validated value should be a object"),code:this.t("invalid"),field:void 0}];var r=[];for(var o in e){var i=h(e[o]),a=t[o];"string"==typeof a&&!0===i.trim&&(a=t[o]=a.trim());var u=this.widelyUndefined;"widelyUndefined"in i&&(u=i.widelyUndefined);u&&(""===a||null===a||Number.isNaN(a))&&(a=t[o]=void 0);if(null!=a){var c=d[i.type];if(!c)throw new TypeError("rule type must be one of "+Object.keys(d).join(", ")+", but the following type was passed: "+i.type);m(i,t,o,this.convert);var s=c.call(this,i,t[o],t);"string"==typeof s&&r.push({message:s,code:this.t("invalid"),field:o});Array.isArray(s)&&s.forEach((function(e){var t="object"===i.type?".":"";e.field=o+t+e.field;r.push(e)}))}else{!1!==i.required&&r.push({message:this.t("required"),field:o,code:this.t("missing_field")});"default"in i&&(t[o]=i.default)}}return r.length?r:void 0}}]);return e}();e.exports=p;p.prototype.addRule=p.addRule=function(e,t,r,n){if(!e)throw new TypeError("`type` required");if("string"==typeof r||"function"==typeof r){n=r;r=!0}"boolean"!=typeof r&&(r=!0);if(!r&&d[e])throw new TypeError("rule `"+e+"` exists");if(n){if("string"!=typeof n&&"function"!=typeof n)throw new TypeError("convertType should be string or function");p.CONVERT_MAP[e]=n}if("function"!=typeof t){if(!(t instanceof RegExp))throw new TypeError("check must be function or regexp");d[e]=function(e,r){return b.call(this,{format:t},r)}}else d[e]=t};var d=p.TYPE_MAP={number:function(e,t){return"number"!=typeof t||isNaN(t)?this.t("should be a number"):e.hasOwnProperty("max")&&t>e.max?this.t("should smaller than %s",e.max):e.hasOwnProperty("min")&&t<e.min?this.t("should bigger than %s",e.min):void 0},int:v,integer:v,string:b,id:function(e,t){return b.call(this,{format:c,allowEmpty:e.allowEmpty},t)},date:function(e,t){return b.call(this,{format:a,allowEmpty:e.allowEmpty},t)},dateTime:g,datetime:g,boolean:w,bool:w,array:function(e,t){if(!Array.isArray(t))return this.t("should be an array");if(e.hasOwnProperty("max")&&t.length>e.max)return this.t("length should smaller than %s",e.max);if(e.hasOwnProperty("min")&&t.length<e.min)return this.t("length should bigger than %s",e.min);if(e.itemType){var r=this,n=d[e.itemType];if(!n)throw new TypeError("rule type must be one of "+Object.keys(d).join(", ")+", but the following type was passed: "+e.itemType);var o=[],i="object"===e.itemType?e:e.rule||h(e.itemType);t.forEach((function(e,t){var a="["+t+"]",u=n.call(r,i,e);"string"==typeof u&&o.push({field:a,message:u,code:r.t("invalid")});Array.isArray(u)&&(o=o.concat(u.map((function(e){e.field=a+"."+e.field;e.message=e.message;return e}))))}));return o}},object:function(e,t){return"object"!==(void 0===t?"undefined":n(t))||Array.isArray(t)?this.t("should be an object"):e.rule?this.validate(e.rule,t):void 0},enum:function(e,t){if(!Array.isArray(e.values))throw new TypeError("check enum need array type values");if(-1===e.values.indexOf(t))return this.t("should be one of %s",e.values.join(", "))},email:function(e,t){return b.call(this,{format:s,message:e.message||this.t("should be an email"),allowEmpty:e.allowEmpty},t)},password:function(e,t,r){e.min||(e.min=6);e.format=l;var n=b.call(this,e,t);return n||(e.compare&&r[e.compare]!==t?this.t("should equal to %s",e.compare):void 0)},url:function(e,t){return b.call(this,{format:f,message:e.message||this.t("should be a url"),allowEmpty:e.allowEmpty},t)}},y=p.CONVERT_MAP={number:"number",int:"int",integer:"int",string:"string",id:"string",date:"string",dateTime:"string",datetime:"string",boolean:"bool",bool:"bool",email:"string",password:"string",url:"string"};function h(e){"string"==typeof(e=e||{})?e={type:e}:Array.isArray(e)?e={type:"enum",values:e}:e instanceof RegExp&&(e={type:"string",format:e});if(e.type&&"?"===e.type[e.type.length-1]){e.type=e.type.slice(0,-1);e.required=!1}return e}function m(e,t,r,o){var i;o&&(i=y[e.type]);e.convertType&&(i=e.convertType);if(i){var a=t[r];if("object"!==(void 0===a?"undefined":n(a)))if("function"!=typeof i)switch(i){case"int":t[r]=parseInt(a,10);break;case"string":t[r]=String(a);break;case"number":t[r]=Number(t[r]);break;case"bool":case"boolean":t[r]=!!a;break;default:"function"==typeof y[i]&&(t[r]=y[e.type](t[r]))}else t[r]=i(a,t)}}function v(e,t){return"number"!=typeof t||t%1!=0?this.t("should be an integer"):e.hasOwnProperty("max")&&t>e.max?this.t("should smaller than %s",e.max):e.hasOwnProperty("min")&&t<e.min?this.t("should bigger than %s",e.min):void 0}function b(e,t){if("string"!=typeof t)return this.t("should be a string");e.hasOwnProperty("allowEmpty")||!1!==e.required||(e.allowEmpty=!0);var r=e.hasOwnProperty("allowEmpty")?e.allowEmpty:e.empty;if(!t){if(r)return;return this.t("should not be empty")}return e.hasOwnProperty("max")&&t.length>e.max?this.t("length should smaller than %s",e.max):e.hasOwnProperty("min")&&t.length<e.min?this.t("length should bigger than %s",e.min):e.format&&!e.format.test(t)?e.message||this.t("should match %s",e.format):void 0}function g(e,t){return b.call(this,{format:u,allowEmpty:e.allowEmpty},t)}function w(e,t){if("boolean"!=typeof t)return this.t("should be a boolean")}},"./src/thirdParty/runtime.es5.js":function(e,t,r){var n=function(e){"use strict";var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(e,t,r){Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0});return e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),a=new j(n||[]);i._invoke=function(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return{value:void 0,done:!0}}r.method=o;r.arg=i;for(;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===l)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n){n="completed";throw r.arg}r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=s(e,t,r);if("normal"===c.type){n=r.done?"completed":"suspendedYield";if(c.arg===l)continue;return{value:c.arg,done:r.done}}if("throw"===c.type){n="completed";r.method="throw";r.arg=c.arg}}}}(e,r,a);return i}e.wrap=c;function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}var l={};function f(){}function p(){}function d(){}var y={};u(y,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(_([])));m&&m!==t&&r.call(m,o)&&(y=m);var v=d.prototype=f.prototype=Object.create(y);p.prototype=d;u(v,"constructor",d);u(d,"constructor",p);p.displayName=u(d,a,"GeneratorFunction");function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))};e.mark=function(e){if(Object.setPrototypeOf)Object.setPrototypeOf(e,d);else{e.__proto__=d;u(e,a,"GeneratorFunction")}e.prototype=Object.create(v);return e};e.awrap=function(e){return{__await:e}};function g(e,t){var n;this._invoke=function(o,i){function a(){return new t((function(n,a){!function n(o,i,a,u){var c=s(e[o],e,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,a,u)}),(function(e){n("throw",e,a,u)})):t.resolve(f).then((function(e){l.value=e;a(l)}),(function(e){return n("throw",e,a,u)}))}u(c.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}b(g.prototype);u(g.prototype,i,(function(){return this}));e.AsyncIterator=g;e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new g(c(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))};function w(e,t){var r=e.iterator[t.method];if(void 0===r){t.delegate=null;if("throw"===t.method){if(e.iterator.return){t.method="return";t.arg=void 0;w(e,t);if("throw"===t.method)return l}t.method="throw";t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=s(r,e.iterator,t.arg);if("throw"===n.type){t.method="throw";t.arg=n.arg;t.delegate=null;return l}var o=n.arg;if(!o){t.method="throw";t.arg=new TypeError("iterator result is not an object");t.delegate=null;return l}if(!o.done)return o;t[e.resultName]=o.value;t.next=e.nextLoc;if("return"!==t.method){t.method="next";t.arg=void 0}t.delegate=null;return l}b(v);u(v,a,"Generator");u(v,o,(function(){return this}));u(v,"toString",(function(){return"[object Generator]"}));function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]);if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(O,this);this.reset(!0)}e.keys=function(e){var t=[];for(var r in e)t.push(r);t.reverse();return function r(){for(;t.length;){var n=t.pop();if(n in e){r.value=n;r.done=!1;return r}}r.done=!0;return r}};function _(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n)){t.value=e[n];t.done=!1;return t}t.value=void 0;t.done=!0;return t};return i.next=i}}return{next:P}}e.values=_;function P(){return{value:void 0,done:!0}}j.prototype={constructor:j,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=void 0;this.done=!1;this.delegate=null;this.method="next";this.arg=void 0;this.tryEntries.forEach(x);if(!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){a.type="throw";a.arg=e;t.next=r;if(n){t.method="next";t.arg=void 0}return!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};a.type=e;a.arg=t;if(i){this.method="next";this.next=i.finallyLoc;return l}return this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;if("break"===e.type||"continue"===e.type)this.next=e.arg;else if("return"===e.type){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else"normal"===e.type&&t&&(this.next=t);return l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e){this.complete(r.completion,r.afterLoc);x(r);return l}}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){this.delegate={iterator:_(e),resultName:t,nextLoc:r};"next"===this.method&&(this.arg=void 0);return l}};return e}(e.exports);try{regeneratorRuntime=n}catch(e){}}})},"./node_modules/@alicloud/mpserverless-miniapp-core/dist/index.js":function(e,t,r){e.exports=function(e,t,r,n,o,i){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./node_modules/crypto-js/core.js":function(e,t,r){e.exports=function(){var e=e||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;e.prototype=t;r=new e;e.prototype=null;return r}}(),n={},o=n.lib={},i=o.Base={extend:function(e){var t=r(this);e&&t.mixIn(e);t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[];this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;this.clamp();if(n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];this.sigBytes+=o;return this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8;t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var r,n=[],o=function(t){t=t;var r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;o/=4294967296;return(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var u=o(4294967296*(r||e.random()));r=987654071*u();n.push(4294967296*u()|0)}return new a.init(n,t)}}),u=n.enc={},c=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16));n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},s=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,u=o/(4*i),c=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*i,s=e.min(4*c,o);if(c){for(var l=0;l<c;l+=i)this._doProcessBlock(n,l);var f=n.splice(0,c);r.sigBytes-=s}return new a.init(f,s)},clone:function(){var e=i.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0}),p=(o.Hasher=f.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){f.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math);return e}()},"./node_modules/crypto-js/hmac-md5.js":function(e,t,r){e.exports=function(e){return e.HmacMD5}(r("./node_modules/crypto-js/core.js"),r("./node_modules/crypto-js/md5.js"),r("./node_modules/crypto-js/hmac.js"))},"./node_modules/crypto-js/hmac.js":function(e,t,r){e.exports=function(e){!function(){var t=e,r=t.lib.Base,n=t.enc.Utf8;t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init;"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,o=4*r;t.sigBytes>o&&(t=e.finalize(t));t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),u=i.words,c=a.words,s=0;s<r;s++){u[s]^=1549556828;c[s]^=909522486}i.sigBytes=a.sigBytes=o;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();return t.finalize(this._oKey.clone().concat(r))}})}()}(r("./node_modules/crypto-js/core.js"))},"./node_modules/crypto-js/md5.js":function(e,t,r){e.exports=function(e){!function(t){var r=e,n=r.lib,o=n.WordArray,i=n.Hasher,a=r.algo,u=[];!function(){for(var e=0;e<64;e++)u[e]=4294967296*t.abs(t.sin(e+1))|0}();var c=a.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],c=e[t+1],d=e[t+2],y=e[t+3],h=e[t+4],m=e[t+5],v=e[t+6],b=e[t+7],g=e[t+8],w=e[t+9],O=e[t+10],x=e[t+11],j=e[t+12],_=e[t+13],P=e[t+14],S=e[t+15],E=i[0],T=i[1],k=i[2],R=i[3];E=s(E,T,k,R,a,7,u[0]);R=s(R,E,T,k,c,12,u[1]);k=s(k,R,E,T,d,17,u[2]);T=s(T,k,R,E,y,22,u[3]);E=s(E,T,k,R,h,7,u[4]);R=s(R,E,T,k,m,12,u[5]);k=s(k,R,E,T,v,17,u[6]);T=s(T,k,R,E,b,22,u[7]);E=s(E,T,k,R,g,7,u[8]);R=s(R,E,T,k,w,12,u[9]);k=s(k,R,E,T,O,17,u[10]);T=s(T,k,R,E,x,22,u[11]);E=s(E,T,k,R,j,7,u[12]);R=s(R,E,T,k,_,12,u[13]);k=s(k,R,E,T,P,17,u[14]);E=l(E,T=s(T,k,R,E,S,22,u[15]),k,R,c,5,u[16]);R=l(R,E,T,k,v,9,u[17]);k=l(k,R,E,T,x,14,u[18]);T=l(T,k,R,E,a,20,u[19]);E=l(E,T,k,R,m,5,u[20]);R=l(R,E,T,k,O,9,u[21]);k=l(k,R,E,T,S,14,u[22]);T=l(T,k,R,E,h,20,u[23]);E=l(E,T,k,R,w,5,u[24]);R=l(R,E,T,k,P,9,u[25]);k=l(k,R,E,T,y,14,u[26]);T=l(T,k,R,E,g,20,u[27]);E=l(E,T,k,R,_,5,u[28]);R=l(R,E,T,k,d,9,u[29]);k=l(k,R,E,T,b,14,u[30]);E=f(E,T=l(T,k,R,E,j,20,u[31]),k,R,m,4,u[32]);R=f(R,E,T,k,g,11,u[33]);k=f(k,R,E,T,x,16,u[34]);T=f(T,k,R,E,P,23,u[35]);E=f(E,T,k,R,c,4,u[36]);R=f(R,E,T,k,h,11,u[37]);k=f(k,R,E,T,b,16,u[38]);T=f(T,k,R,E,O,23,u[39]);E=f(E,T,k,R,_,4,u[40]);R=f(R,E,T,k,a,11,u[41]);k=f(k,R,E,T,y,16,u[42]);T=f(T,k,R,E,v,23,u[43]);E=f(E,T,k,R,w,4,u[44]);R=f(R,E,T,k,j,11,u[45]);k=f(k,R,E,T,S,16,u[46]);E=p(E,T=f(T,k,R,E,d,23,u[47]),k,R,a,6,u[48]);R=p(R,E,T,k,b,10,u[49]);k=p(k,R,E,T,P,15,u[50]);T=p(T,k,R,E,m,21,u[51]);E=p(E,T,k,R,j,6,u[52]);R=p(R,E,T,k,y,10,u[53]);k=p(k,R,E,T,O,15,u[54]);T=p(T,k,R,E,c,21,u[55]);E=p(E,T,k,R,g,6,u[56]);R=p(R,E,T,k,S,10,u[57]);k=p(k,R,E,T,v,15,u[58]);T=p(T,k,R,E,_,21,u[59]);E=p(E,T,k,R,h,6,u[60]);R=p(R,E,T,k,x,10,u[61]);k=p(k,R,E,T,d,15,u[62]);T=p(T,k,R,E,w,21,u[63]);i[0]=i[0]+E|0;i[1]=i[1]+T|0;i[2]=i[2]+k|0;i[3]=i[3]+R|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;r[o>>>5]|=128<<24-o%32;var i=t.floor(n/4294967296),a=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);r[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8);e.sigBytes=4*(r.length+1);this._process();for(var u=this._hash,c=u.words,s=0;s<4;s++){var l=c[s];c[s]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return u},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});function s(e,t,r,n,o,i,a){var u=e+(t&r|~t&n)+o+a;return(u<<i|u>>>32-i)+t}function l(e,t,r,n,o,i,a){var u=e+(t&n|r&~n)+o+a;return(u<<i|u>>>32-i)+t}function f(e,t,r,n,o,i,a){var u=e+(t^r^n)+o+a;return(u<<i|u>>>32-i)+t}function p(e,t,r,n,o,i,a){var u=e+(r^(t|~n))+o+a;return(u<<i|u>>>32-i)+t}r.MD5=i._createHelper(c);r.HmacMD5=i._createHmacHelper(c)}(Math);return e.MD5}(r("./node_modules/crypto-js/core.js"))},"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"MPHTTPRequestEncoder",(function(){return j}));r.d(t,"MPHTTPResponseDecoder",(function(){return _}));r.d(t,"MPHTTPTransport",(function(){return D}));r.d(t,"HighFileSevice",(function(){return H}));r.d(t,"MPServerlessMiniAppCore",(function(){return oe}));var n=r("@alicloud/mpserverless-core"),o=r("./node_modules/crypto-js/core.js"),i=r.n(o),a=r("./node_modules/crypto-js/hmac-md5.js"),u=r.n(a),c=Object(n.MPServerlessErrorClass)({UnauthorizedError:{code:"UnauthorizedError",message:"未授权错误"},InterfaceRequestError:{code:"InterfaceRequestError",message:"接口请求错误"}});function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){x(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function m(e,t,r){t&&h(e.prototype,t);r&&h(e,r);return e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&function(e,t){(Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=O(e);if(t){var o=O(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return g(this,r)}}function g(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?w(e):t}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var j=function(e){v(r,e);var t=b(r);function r(e,o){var i;y(this,r);(i=t.call(this,e)).spaceId=o;x(w(i),"prefix",n.PREFIX.CLIENT);x(w(i),"serviceHeaders",{});i.setBodyField({spaceId:o});return i}m(r,[{key:"sign",value:function(e){var t=this.body,r=t.spaceId,n=t.method,o=t.params,a=t.token,c=t.userId,s=Date.now();this.setBodyField({timestamp:s});var l="",f={spaceId:r,timestamp:s,method:n,params:JSON.stringify(o),token:a,userId:c};Object.keys(f).sort().forEach((function(e){f[e]&&(l="".concat(l,"&").concat(e,"=").concat(f[e]))}));l=l.slice(1);try{var p=u()(l,e).toString(i.a.enc.Hex);this.setServerlessHeaders({sign:p})}catch(e){throw e}}},{key:"encodeAsHTTPRequestObject",value:function(e){this.body.params&&(this.body.params=JSON.stringify(this.body.params));return d({url:this.url,data:this.body,method:this.method,headers:this.headers,dataType:"json"},e)}},{key:"clone",value:function(){var e=new r(this.endpoint,this.spaceId);e.setBodyField(this.body);e.setBaseHeaders(this.baseHeaders);e.setServerlessHeaders(this.serverlessHeaders);return e}}]);return r}(n.HTTPRequestEncoder),_=function(e){v(r,e);var t=b(r);function r(){var e;y(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];x(w(e=t.call.apply(t,[this].concat(o))),"ERROR_CODES",[11,12,13,14,19,20]);return e}m(r,[{key:"setStatusAndBody",value:function(e,t){f(O(r.prototype),"setStatusAndBody",this).call(this,e,t);this.ERROR_CODES.indexOf(e)>=0&&(this._error=new c.InterfaceRequestError("错误码 ".concat(e.toString(),", 请参考对应开放平台文档排查问题")))}},{key:"decode",value:function(e){this.setHeaders(e.headers||{});var t=e.data||e.body;"string"==typeof t&&(t=JSON.parse(t));if(t&&"data"in t){if(null==t.data)t.result=null;else if(Number(t.data.affectedDocs)===t.data.affectedDocs)t=Object.assign({},t,d({},t.data));else if("[object Object]"===Object.prototype.toString.call(t.data))t.result=Object.assign({},t.data);else if("[object Array]"===Object.prototype.toString.call(t.data)){var n=function(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);return"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.data);t.result=n.slice(0)}else t.result=t.data;delete t.data}if(/^request:fail+/.test(e.errMsg)){this.setErrorMessage(e.errMsg);return f(O(r.prototype),"decode",this).call(this)}var o=parseInt(e.error,10);if(o){this.setStatusAndBody(o,t);return f(O(r.prototype),"decode",this).call(this)}var i=e.err;if(i){this.setErrorMessage(i);return f(O(r.prototype),"decode",this).call(this)}if(e instanceof Error){this.setErrorObject(e);return f(O(r.prototype),"decode",this).call(this)}if(t&&"object"===s(t.error)){this.setErrorObject(t.error);return f(O(r.prototype),"decode",this).call(this)}var a=parseInt(e.status||e.statusCode,10);if(a){this.setStatusAndBody(a,t);return f(O(r.prototype),"decode",this).call(this)}this.setStatusAndBody(200,e);return f(O(r.prototype),"decode",this).call(this)}}]);return r}(n.HTTPResponseDecoder);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function E(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){S(i,n,o,a,u,"next",e)}function u(e){S(i,n,o,a,u,"throw",e)}a(void 0)}))}}function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function R(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?A(e):t}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&k(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=q(e);if(t){var o=q(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return R(this,r)}}(r);function r(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);I(A(n=t.call(this,e)),"userService",void 0);I(A(n),"httpRequest",void 0);return n}!function(e,t,r){t&&T(e.prototype,t)}(r,[{key:"setUserService",value:function(e){this.userService=e}},{key:"setRequest",value:function(e){Object(n.assert)(e,"初始化时缺少 request 参数");this.httpRequest=e}},{key:"getEncoder",value:function(e){return new j(this.endpoint,this.spaceId)}},{key:"request",value:function(){var e=E(regeneratorRuntime.mark((function e(t){var r,n,o,i,a,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u.length>1&&void 0!==u[1]&&u[1];n=t.clone();e.next=4;return this.userService.setRequestToken(t,r);case 4:o=e.sent;this.ua&&o.setBaseHeaders({"x-serverless-ua":this.ua});e.prev=6;i=o.encodeAsHTTPRequestObject({timeout:this.timeout,dataType:"json"});this.logger.info("request encode data",i);e.next=11;return this.httpRequest(i);case 11:a=e.sent;return e.abrupt("return",a);case 15:e.prev=15;e.t0=e.catch(6);this.logger.error("request error",e.t0);if("GATEWAY_INVALID_TOKEN"!==e.t0.error.code&&"InvalidParameter.InvalidToken"!==e.t0.error.code){e.next=25;break}if(!r){e.next=22;break}throw new c.UnauthorizedError("授权 token 已过期，重新获取失败");case 22:e.next=24;return this.request(n,!0);case 24:return e.abrupt("return",e.sent);case 25:if(!e.t0.error){e.next=27;break}throw e.t0.error;case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[6,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"wrapApi",value:function(e){var t=this;return function(){var r=E(regeneratorRuntime.mark((function r(n){var o,i,a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return e(n);case 2:o=r.sent;t.logger.info("completed request");t.logger.info(JSON.stringify(o,null,2));i=new _;if(!(a=i.decode(o)).error){r.next=9;break}throw a;case 9:return r.abrupt("return",a);case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}}]);return r}(n.HTTPTransport);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function B(e,t,r){return(B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function z(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?U(e):t}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&N(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=F(e);if(t){var o=F(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return z(this,r)}}(r);function r(e,o){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(U(i=t.call(this,e,o)),"getFileUploadInfo",void 0);Object(n.assert)(o.getFileUploadInfo,"[MPFileService]初始化时缺少 getFileUploadInfo 参数");i.getFileUploadInfo=o.getFileUploadInfo;return i}!function(e,t,r){t&&L(e.prototype,t)}(r,[{key:"uploadFile",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){C(i,n,o,a,u,"next",e)}function u(e){C(i,n,o,a,u,"throw",e)}a(void 0)}))}}(regeneratorRuntime.mark((function e(t){var o,i,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(n.assert)(t,"options required");Object(n.assert)(t.filePath&&"string"==typeof t.filePath,"[MPFileService]调用 uploadFile 缺少 filePath 参数");e.next=4;return this.getFileUploadInfo({filePath:t.filePath});case 4:o=e.sent;i=o.body,a=i.fileSize,u=i.fileExtension;!t.fileSize&&a&&(t.fileSize=a);!t.extension&&u&&(t.extension=u);"string"==typeof t.fileSize&&(t.fileSize=parseInt(t.fileSize));e.next=11;return B(F(r.prototype),"uploadFile",this).call(this,t);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]);return r}(r("@alicloud/mp-file-service").MPFileService),G=r("@alicloud/mp-proxy-service"),Y=r("@alicloud/mp-db-service"),V=r("@alicloud/mp-user-service"),J=r("@alicloud/mp-function-service");function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){ne(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function X(e,t,r){return(X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=re(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function ee(e,t){return!t||"object"!==$(t)&&"function"!=typeof t?te(e):t}function te(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ne(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&Q(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=re(e);if(t){var o=re(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ee(this,r)}}(r);function r(e,o){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);ne(te(i=t.call(this,W(W({},o),{},{httpTransport:D,options:e.logger}))),"db",void 0);ne(te(i),"file",void 0);ne(te(i),"user",void 0);ne(te(i),"function",void 0);ne(te(i),"network",void 0);Object(n.assert)(o.clientSecret,"clientSecret is required");Object(n.assert)(o.appId,"appId is required");i.user=new V.UserService(i.transport,{getAuthCode:i.transport.wrapApi(e.getAuthCode),request:i.transport.wrapApi(e.request),appId:o.appId,appSecret:o.clientSecret,isvAppId:o.isvAppId,ua:i.ua});i.transport.setUserService(i.user);i.transport.setRequest(i.transport.wrapApi(e.request));i.db=new Y.DbService(i.transport);i.file=new H(i.transport,{uploadFile:i.transport.wrapApi(e.uploadFile),getFileUploadInfo:i.transport.wrapApi(e.getFileUploadInfo)});i.function=new J.FunctionService(i.transport);i.network=new G.ProxyService(i.transport);return i}!function(e,t,r){t&&Z(e.prototype,t)}(r,[{key:"version",get:function(){return"3.0.0"}},{key:"ua",get:function(){return"pkg_name:@alicloud/mpserverless-sdk;ver:3.0.0;"}},{key:"createTransport",value:function(e){X(re(r.prototype),"createTransport",this).call(this,e);this.transport.setAppSecret(e.clientSecret).setUA(this.ua)}}]);return r}(n.MPServerlessCore)},"@alicloud/mp-db-service":function(t,r){t.exports=e},"@alicloud/mp-file-service":function(e,r){e.exports=t},"@alicloud/mp-function-service":function(e,t){e.exports=r},"@alicloud/mp-proxy-service":function(e,t){e.exports=n},"@alicloud/mp-user-service":function(e,t){e.exports=o},"@alicloud/mpserverless-core":function(e,t){e.exports=i}})}(r("./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-db-service/dist/index.js"),r("./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-file-service/dist/index.js"),r("./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-function-service/dist/index.js"),r("./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-proxy-service/dist/index.js"),r("./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-user-service/dist/index.js"),r("./node_modules/@alicloud/mpserverless-core/dist/index.js"))},"./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-db-service/dist/index.js":function(e,t,r){e.exports=function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"DbService",(function(){return Ce}));var n=r("@alicloud/mpserverless-core");function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function a(e,t,r){t&&i(e.prototype,t);r&&i(e,r);return e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&function(e,t){(Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return s(this,r)}}function s(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var p=["i","m","u","g"];function d(e){return Array.isArray(e)}function y(e){return null!==e&&"object"===f(e)&&!d(e)}function h(e){return"string"==typeof e||function(e,t){return Object.prototype.toString.call(e)==="[object ".concat("String","]")}(e)}var m=function(e){u(r,e);var t=c(r);function r(){o(this,r);return t.apply(this,arguments)}a(r,[{key:"encode",value:function(e){var t=this;return e instanceof RegExp?this.toRegexp(e):e instanceof Date?this.toDate(e):d(e)?e.map((function(e){return t.encode(e)})):y(e)?Object.keys(e).reduce((function(r,n){r[n]=t.encode(e[n]);return r}),{}):e}},{key:"toDate",value:function(e){return e.toISOString()}},{key:"toRegexp",value:function(e){return"/".concat(e.source.replace(/\\\//g,"/"),"/").concat(e.flags)}}]);return r}(n.BaseEncoder),v=function(e){u(r,e);var t=c(r);function r(){o(this,r);return t.apply(this,arguments)}a(r,[{key:"decode",value:function(e){var t=this;return this.isDate(e)?this.toDate(e):d(e)?e.map((function(e){return t.decode(e)})):y(e)?Object.keys(e).reduce((function(r,n){r[n]=t.decode(e[n]);return r}),{}):e}},{key:"isDate",value:function(e){return h(e)&&/^\d{4}\-\d{2}\-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/.test(e)&&!isNaN(Date.parse(e))}},{key:"isRegexp",value:function(e){if(h(e)){var t=!0,r=e.split("/"),n=r[r.length-1];n&&(t=n.split("").reduce((function(e,t){return!0===e&&p.indexOf(t)>-1}),!0));return r.length>=2&&t}return!1}},{key:"toDate",value:function(e){return new Date(e)}},{key:"toRegexp",value:function(e){var t=e.indexOf("/"),r=e.lastIndexOf("/");return new RegExp(e.slice(t+1,r),e.slice(r+1))}}]);return r}(n.BaseDecoder);function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}var g,w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(this,"name",void 0);this.name=t}!function(e,t,r){t&&b(e.prototype,t)}(e,[{key:"inspect",value:function(){return{collection:this.name}}}]);return e}();!function(e){e.READ=".read";e.WRITE=".write";e.CREATE="document.create";e.UPDATE="document.update";e.DELETE="document.delete";e.AGGREGATE=".aggregate"}(g||(g={}));function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&function(e,t){(Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=S(e);if(t){var o=S(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return _(this,r)}}function _(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?P(e):t}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function A(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var q=function(){function e(t){k(this,e);A(this,"name",void 0);A(this,"_schema",{});A(this,"_argMap",{});A(this,"_permission",void 0);this._argMap=t;this._argMap.options||(this._argMap.options={})}!function(e,t,r){t&&R(e.prototype,t)}(e,[{key:"permission",get:function(){switch(this._permission){case g.CREATE:case g.UPDATE:case g.DELETE:return g.WRITE;default:return this._permission}}},{key:"argMap",get:function(){return this._argMap}},{key:"schema",get:function(){return this._schema}},{key:"augmentOptions",value:function(e){this.argMap.options=Object.assign({},this.argMap.options,e)}},{key:"inspect",value:function(){return T(T({},function e(t){for(var r=0,n=Object.keys(t);r<n.length;r++){var o=n[r];y(t[o])&&(0===Object.keys(t[o]).length?"{}"!==JSON.stringify(t[o])&&delete t[o]:e(t[o]));void 0===t[o]&&delete t[o]}return t}(JSON.parse(JSON.stringify(this.argMap)))),{},{command:this.name})}}]);return e}(),I=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","aggregate");A(P(e),"_schema",{pipeline:"array",options:{type:"object",required:!1,rule:{explain:{type:"boolean",required:!1},allowDiskUse:{type:"boolean",required:!1},maxTimeMS:{type:"int",required:!1,min:0},bypassDocumentValidation:{type:"boolean",required:!1},raw:{type:"boolean",required:!1},promoteLongs:{type:"boolean",required:!1},promoteValues:{type:"boolean",required:!1},promoteBuffers:{type:"boolean",required:!1},collation:{type:"object",required:!1}}}});A(P(e),"_permission",g.AGGREGATE);return e}return r}(q),D=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","count");A(P(e),"_schema",{query:"object",options:{type:"object",required:!1,rule:{limit:{type:"int",required:!1,min:0},skip:{type:"int",required:!1,min:0},maxTimeMS:{type:"int",required:!1,min:0}}}});A(P(e),"_permission",g.READ);return e}return r}(q),M=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","distinct");A(P(e),"_schema",{key:"string",query:"object",options:{type:"object",required:!1}});A(P(e),"_permission",g.READ);return e}return r}(q),C=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","findOne");A(P(e),"_schema",{query:{type:"object",required:!1},options:{type:"object",required:!1,rule:{limit:{type:"int",required:!1,min:0},skip:{type:"int",required:!1,min:0},maxTimeMS:{type:"int",required:!1,min:0},sort:{type:"sort",required:!1},projection:{type:"projection",required:!1},hint:{type:"object",required:!1}}}});A(P(e),"_permission",g.READ);return e}return r}(q),L=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","find");A(P(e),"_schema",{query:{type:"object",required:!1},options:{type:"object",required:!1,rule:{limit:{type:"int",required:!1,min:0},skip:{type:"int",required:!1,min:0},maxTimeMS:{type:"int",required:!1,min:0},sort:{type:"sort",required:!1},projection:{type:"projection",required:!1},hint:{type:"object",required:!1}}}});A(P(e),"_permission",g.READ);return e}return r}(q),B=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","insertOne");A(P(e),"_schema",{doc:"field",options:{type:"object",required:!1}});A(P(e),"_permission",g.CREATE);return e}return r}(q),N=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","insertMany");A(P(e),"_schema",{docs:"fields",options:{type:"object",required:!1}});A(P(e),"_permission",g.CREATE);return e}return r}(q),z=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","findOneAndUpdate");A(P(e),"_schema",{filter:"object",update:"object",options:{type:"object",required:!1,rule:{maxTimeMS:{type:"int",min:0,required:!1},sort:{type:"sort",required:!1},upsert:{type:"boolean",required:!1},projection:{type:"projection",required:!1},returnNewDocument:{type:"boolean",required:!1}}}});A(P(e),"_permission",g.UPDATE);return e}return r}(q),U=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","updateOne");A(P(e),"_schema",{filter:"object",update:"nobject",options:{type:"object",required:!1,rule:{upsert:{type:"boolean",required:!1}}}});A(P(e),"_permission",g.UPDATE);return e}return r}(q),F=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","updateMany");A(P(e),"_schema",{filter:"object",update:"nobject",options:{type:"object",required:!1,rule:{upsert:{type:"boolean",required:!1}}}});A(P(e),"_permission",g.UPDATE);return e}return r}(q),H=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","findOneAndReplace");A(P(e),"_schema",{filter:"object",replacement:"object",options:{type:"object",required:!1,rule:{maxTimeMS:{type:"int",min:0,required:!1},sort:{type:"sort",required:!1},upsert:{type:"boolean",required:!1},projection:{type:"projection",required:!1}}}});A(P(e),"_permission",g.UPDATE);return e}return r}(q),G=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","replaceOne");A(P(e),"_schema",{filter:"object",doc:"object",options:{type:"object",required:!1,rule:{upsert:{type:"boolean",required:!1}}}});A(P(e),"_permission",g.UPDATE);return e}return r}(q),Y=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","findOneAndDelete");A(P(e),"_schema",{filter:"object",options:{type:"object",required:!1,rule:{maxTimeMS:{type:"int",min:0,required:!1},sort:{type:"sort",required:!1},projection:{type:"object",required:!1}}}});A(P(e),"_permission",g.DELETE);return e}return r}(q),V=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","deleteOne");A(P(e),"_schema",{filter:{type:"object"},options:{type:"object",required:!1}});A(P(e),"_permission",g.DELETE);return e}return r}(q),J=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","deleteMany");A(P(e),"_schema",{filter:{type:"object"},options:{type:"object",required:!1}});A(P(e),"_permission",g.DELETE);return e}return r}(q),$=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","startTransaction");return e}return r}(q),K=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","commitTransaction");return e}return r}(q),W=function(e){x(r,e);var t=j(r);function r(){var e;k(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];A(P(e=t.call.apply(t,[this].concat(o))),"name","abortTransaction");return e}return r}(q);function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function X(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var Q,ee=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);X(this,"raw",void 0);X(this,"encoder",new m);X(this,"decoder",new v);this.raw=this.decoder.decode(t)}!function(e,t,r){t&&Z(e.prototype,t)}(e,[{key:"inspect",value:function(){return this.raw}}]);return e}();function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){e.INVALID_TYPE="field type is invalid";e.NOT_ARRAY="field is not an array";e.ILLEGAL="field should not contain illegal character";e.ILLEGAL_VALUE="field should not contain undefined for a value";e.EMPTY_OBJECT="field should not be an empty object";e.NOT_OBJECT="should be an object";e.EMPTY="should not empty"}(Q||(Q={}));function re(e,t,r){function n(e){if(/[\.\$]/.test(e))return Q.ILLEGAL}if(!(t instanceof Object))return Q.INVALID_TYPE;if(Array.isArray(t))return Q.INVALID_TYPE;for(var o=0,i=Object.keys(t);o<i.length;o++){var a=i[o],u=n(a);if("string"==typeof u)return u;if(t[a]instanceof Object&&!Array.isArray(t[a])){var c=re(e,t[a]);if(c)return c}}}var ne={ruleOfField:re,ruleOfFields:function(e,t){if(!Array.isArray(t))return Q.NOT_ARRAY;if(0===t.length)return Q.EMPTY;for(var r,n=0;!r&&n<t.length;){r=re(null,t[n],t[n]);n++}return r},ruleOfSort:function(e,t){var r=[1,-1];function n(e){if(/[\$]/.test(e))return Q.ILLEGAL}if(!(t instanceof Object))return Q.INVALID_TYPE;if("{}"!==JSON.stringify(t)){if(Array.isArray(t))return Q.INVALID_TYPE;for(var o=null,i=0,a=Object.keys(t);i<a.length;i++){var u=a[i];if("string"==typeof(o=n(u)))return o;if(!r.includes(t[u]))return Q.INVALID_TYPE}return null===o?Q.INVALID_TYPE:void 0}},ruleOfProjection:function(e,t){var r=[1,0];function n(e){if(/[\$]/.test(e))return Q.ILLEGAL}if(!(t instanceof Object))return Q.INVALID_TYPE;if("{}"!==JSON.stringify(t)){if(Array.isArray(t))return Q.INVALID_TYPE;for(var o=null,i=0,a=Object.keys(t);i<a.length;i++){var u=a[i];if("string"==typeof(o=n(u)))return o;if(!r.includes(t[u]))return Q.INVALID_TYPE}return null===o?Q.INVALID_TYPE:void 0}},ruleOfNobject:function(e,t){return"object"!==te(t)?Q.NOT_OBJECT:0===Object.keys(t).length?Q.EMPTY_OBJECT:void 0}};function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function ae(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ce,se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&ie(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=ue(e);if(t){var o=ue(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ae(this,r)}}(r);function r(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);n=t.call(this,e);for(var o=0,i=Object.keys(ne);o<i.length;o++){var a=i[o],u=a.match(/ruleOf([a-zA-Z]+)/)[1];n.p.addRule(u[0].toLowerCase()+u.slice(1),ne[a])}return n}return r}(n.Validator);function le(e){return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t,r){return(fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=he(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function de(e,t){return!t||"object"!==le(t)&&"function"!=typeof t?ye(e):t}function ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function ve(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){me(i,n,o,a,u,"next",e)}function u(e){me(i,n,o,a,u,"throw",e)}a(void 0)}))}}function be(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function we(e,t,r){t&&ge(e.prototype,t);r&&ge(e,r);return e}function Oe(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}!function(e){e.AGGREGATE="aggregate";e.COUNT="count";e.DISTINCT="distinct";e.FIND_ONE="findone";e.FIND="find";e.INSERT_ONE="insertOne";e.INSERT_MANY="insertMany";e.FIND_ONE_AND_UPDATE="findOneAndUpdate";e.UPDATE_ONE="updateOne";e.UPDATE_MANY="updateMany";e.FIND_ONE_AND_REPLACE="findOneAndReplace";e.REPLACE_ONE="replaceOne";e.FIND_ONE_AND_DELETE="findOneAndDelete";e.DELETE_ONE="deleteOne";e.DELETE_MANY="deleteMany"}(ce||(ce={}));var xe,je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&pe(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=he(e);if(t){var o=he(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return de(this,r)}}(r);function r(){var e;be(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];Oe(ye(e=t.call.apply(t,[this].concat(o))),"getEncoder",void 0);Oe(ye(e),"getTransport",void 0);return e}we(r,[{key:"execute",value:function(){var e=ve(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return fe(he(r.prototype),"execute",this).call(this);case 2:t=e.sent;n=this.getEncoder().setBodyField({method:"serverless.db.default.execute",params:t});e.next=6;return this.getTransport().request(n);case 6:o=e.sent;return e.abrupt("return",new ee(o.body).inspect());case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]);return r}(function(){function e(){be(this,e);Oe(this,"transId",void 0);Oe(this,"coll",void 0);Oe(this,"comm",void 0);Oe(this,"encoder",new m);Oe(this,"decoder",new v)}we(e,[{key:"transaction",value:function(){var e=ve(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.comm=new $({});e.next=3;return this.execute();case 3:(t=e.sent)&&(this.transId=t.transactionId);return e.abrupt("return",this.transId);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"commit",value:function(){var e=ve(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.comm=new K({});return e.abrupt("return",this.execute());case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rollback",value:function(){var e=ve(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.comm=new W({});return e.abrupt("return",this.execute());case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"collection",value:function(e){this.coll=new w(e);return this}},{key:"aggregate",value:function(e,t){this.validateTransactionAction(ce.AGGREGATE);this.comm=new I({pipeline:e,options:t});return this.execute()}},{key:"count",value:function(e,t){this.validateTransactionAction(ce.COUNT);this.comm=new D({query:e,options:t});return this.execute()}},{key:"distinct",value:function(e,t,r){this.validateTransactionAction(ce.DISTINCT);this.comm=new M({key:e,query:t,options:r});return this.execute()}},{key:"findOne",value:function(e,t){this.comm=new C({query:e,options:t});return this.execute()}},{key:"find",value:function(e,t){this.validateTransactionAction(ce.FIND);this.comm=new L({query:e,options:t});return this.execute()}},{key:"insertOne",value:function(e,t){this.comm=new B({doc:e,options:t});return this.execute()}},{key:"insertMany",value:function(e,t){this.validateTransactionAction(ce.INSERT_MANY);this.comm=new N({docs:e,options:t});return this.execute()}},{key:"findOneAndUpdate",value:function(e,t,r){this.comm=new z({filter:e,update:t,options:r});return this.execute()}},{key:"updateOne",value:function(e,t,r){this.comm=new U({filter:e,update:t,options:r});return this.execute()}},{key:"updateMany",value:function(e,t,r){this.validateTransactionAction(ce.UPDATE_MANY);this.comm=new F({filter:e,update:t,options:r});return this.execute()}},{key:"findOneAndReplace",value:function(e,t,r){this.comm=new H({filter:e,replacement:t,options:r});return this.execute()}},{key:"replaceOne",value:function(e,t,r){this.comm=new G({filter:e,doc:t,options:r});return this.execute()}},{key:"findOneAndDelete",value:function(e,t){this.comm=new Y({filter:e,options:t});return this.execute()}},{key:"deleteOne",value:function(e,t){this.comm=new V({filter:e,options:t});return this.execute()}},{key:"deleteMany",value:function(e,t){this.validateTransactionAction(ce.DELETE_MANY);this.comm=new J({filter:e,options:t});return this.execute()}},{key:"validate",value:function(){var e=new se;try{e.validate(this.comm.schema,this.encoder.encode(this.comm.argMap))}catch(e){throw e}}},{key:"execute",value:function(){var e=ve(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(n.assert)(this.comm,"[DBService]缺少 command 参数");this.validate();e.t0=this.comm.permission;e.next=e.t0===g.AGGREGATE||e.t0===g.WRITE||e.t0===g.READ?5:7;break;case 5:Object(n.assert)(this.collection,"[DBService]缺少 collection 参数");return e.abrupt("break",7);case 7:t=Object.assign({},this.coll&&this.coll.inspect(),this.transId&&{transactionId:this.transId},this.comm.inspect());return e.abrupt("return",this.encoder.encode(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateTransactionAction",value:function(e){if(this.transId)throw new n.bizError.TransactionError("transaction not support action ["+e+"]")}}]);return e}());function _e(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function Pe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){_e(i,n,o,a,u,"next",e)}function u(e){_e(i,n,o,a,u,"throw",e)}a(void 0)}))}}function Se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function Ee(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}!function(e){e.INIT="init";e.COMMIT="commit";e.ROLLBACK="rollback"}(xe||(xe={}));var Te=function(){function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);Ee(this,"id",void 0);Ee(this,"status",void 0);Ee(this,"httpTransport",void 0);Ee(this,"httpRequestEncoder",void 0);Ee(this,"queryService",void 0);this.status=xe.INIT;this.httpTransport=t;this.httpRequestEncoder=r;this.queryService=new je;this.queryService.getEncoder=function(){return n.httpRequestEncoder};this.queryService.getTransport=function(){return n.httpTransport}}!function(e,t,r){t&&Se(e.prototype,t)}(e,[{key:"init",value:function(){var e=Pe(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;return this.queryService.transaction();case 2:this.id=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"collection",value:function(e){this.queryService&&this.queryService.collection(e);return this.queryService}},{key:"commit",value:function(){var e=Pe(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkStatus();this.status=xe.COMMIT;return e.abrupt("return",this.queryService.commit());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rollback",value:function(){var e=Pe(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.checkStatus();this.status=xe.ROLLBACK;return e.abrupt("return",this.queryService.rollback());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkStatus",value:function(){if(this.status===xe.COMMIT||this.status===xe.ROLLBACK)throw new n.bizError.TransactionError("transaction already "+this.status)}}]);return e}();function ke(e){return(ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function De(e,t){return!t||"object"!==ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&Ie(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=Me(e);if(t){var o=Me(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return De(this,r)}}(r);function r(){Ae(this,r);return t.apply(this,arguments)}!function(e,t,r){t&&qe(e.prototype,t)}(r,[{key:"collection",value:function(e){var t=this,r=(new je).collection(e);r.getEncoder=function(){return t.getEncoder()};r.getTransport=function(){return t.transport};return r}},{key:"startTransaction",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){Re(i,n,o,a,u,"next",e)}function u(e){Re(i,n,o,a,u,"throw",e)}a(void 0)}))}}(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new Te(this.transport,this.getEncoder());e.next=3;return t.init();case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]);return r}(n.BaseService)},"@alicloud/mpserverless-core":function(t,r){t.exports=e}})}(r("./node_modules/@alicloud/mpserverless-core/dist/index.js"))},"./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-file-service/dist/index.js":function(e,t,r){e.exports=function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./node_modules/mime/Mime.js":function(e,t,r){"use strict";function n(){this._types=Object.create(null);this._extensions=Object.create(null);for(let e=0;e<arguments.length;e++)this.define(arguments[e]);this.define=this.define.bind(this);this.getType=this.getType.bind(this);this.getExtension=this.getExtension.bind(this)}n.prototype.define=function(e,t){for(let r in e){let n=e[r].map((function(e){return e.toLowerCase()}));r=r.toLowerCase();for(let e=0;e<n.length;e++){const o=n[e];if("*"!==o[0]){if(!t&&o in this._types)throw new Error('Attempt to change mapping for "'+o+'" extension from "'+this._types[o]+'" to "'+r+'". Pass `force=true` to allow this, otherwise remove "'+o+'" from the list of extensions for "'+r+'".');this._types[o]=r}}if(t||!this._extensions[r]){const e=n[0];this._extensions[r]="*"!==e[0]?e:e.substr(1)}}};n.prototype.getType=function(e){let t=(e=String(e)).replace(/^.*[/\\]/,"").toLowerCase(),r=t.replace(/^.*\./,"").toLowerCase(),n=t.length<e.length;return(r.length<t.length-1||!n)&&this._types[r]||null};n.prototype.getExtension=function(e){return(e=/^\s*([^;\s]*)/.test(e)&&RegExp.$1)&&this._extensions[e.toLowerCase()]||null};e.exports=n},"./node_modules/mime/lite.js":function(e,t,r){"use strict";let n=r("./node_modules/mime/Mime.js");e.exports=new n(r("./node_modules/mime/types/standard.js"))},"./node_modules/mime/types/standard.js":function(e,t){e.exports={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]}},"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"OSSUploadResponseFormat",(function(){return v}));r.d(t,"OSSUploadHeaderList",(function(){return g}));r.d(t,"WHITELIST_EXTENSIONS",(function(){return w}));r.d(t,"MPFileService",(function(){return O}));var n=r("@alicloud/mpserverless-core"),o={options:{type:"object",rule:{fileSize:{type:"int",required:!1,min:0},extension:{type:"enum",required:!1,values:[".jpg",".jpeg",".png",".gif",".image","jpg","jpeg","png","gif","image",".pdf",".xls",".xlsx",".doc",".docx",".ppt",".pptx",".txt"]},filePath:{type:"string"},env:{type:"enum",required:!1,values:["public"]},timeout:{type:"int",required:!1,min:0},headers:{type:"object",required:!1,rules:{cacheControl:{type:"string",required:!1},contentDisposition:{type:"string",required:!1},contentEncoding:{type:"string",required:!1},expires:{type:"string",required:!1}}},meta:{type:"object",required:!1}}}},i={url:"url"},a=r("./node_modules/mime/lite.js"),u=r.n(a),c=Object(n.MPServerlessErrorClass)({InterfaceError:{code:"InterfaceError",message:"接口响应失败"}});function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,u,"next",e)}function u(e){l(i,n,o,a,u,"throw",e)}a(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function y(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){return{id:e.id,key:e.ossPath,host:e.host,policy:e.policy,Signature:e.signature,OSSAccessKeyId:e.accessKeyId,securityToken:e.securityToken,cdnDomain:e.cdnDomain}}var b,g=["Expires","Cache-Control","Content-Type","Content-Encoding","Content-Disposition"],w=["jpg","jpeg","png","gif","webp","svg","image","pdf","xls","xlsx","doc","docx","ppt","pptx","txt"];!function(e){e.PUBLIC="public";e.PRIVATE="private"}(b||(b={}));var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&d(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=m(e);if(t){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return y(this,r)}}(r);function r(e,o){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(h(i=t.call(this,e)),"upload",void 0);Object(n.assert)(o,"[MPFileService]初始化时缺少参数");Object(n.assert)(o.uploadFile,"[MPFileService]初始化时缺少 uploadFile 参数");i.upload=o.uploadFile;return i}!function(e,t,r){t&&p(e.prototype,t)}(r,[{key:"deleteFile",value:function(){var e=f(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.validate(i,{url:t});(r=this.getEncoder()).setBodyField({method:"serverless.file.resource.delete",params:{id:t}});e.next=5;return this.transport.request(r);case 5:n=e.sent;return e.abrupt("return",n.body);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadFile",value:function(){var e=f(regeneratorRuntime.mark((function e(t){var r,i,a,s,l,f,p,d,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.validate(o,{options:t});r=t.filePath.replace(/(.*):\/\//,"");i=r.split(".").pop();Object(n.assert)(w.indexOf(i.toLowerCase())>=0,"[MPFileService]目前不支持 ".concat(i," 类型文件"));a=Object.keys(t.meta||{}).reduce((function(e,r){e["x-oss-meta-".concat(r)]=t.meta[r];return e}),{});s=t.headers?g.reduce((function(e,r){var n=r.replace(/\-[A-Z]/g,(function(e){return e[1]})).replace(/^[A-Z]/,(function(e){return e.toLowerCase()}));t.headers.hasOwnProperty(n)&&(e[r]=t.headers[n]);return e}),{}):{};e.next=8;return this.getOSSUploadOptionsFromPath(r,t.path,t.fileSize);case 8:if(!(l=e.sent).error){e.next=11;break}throw new c.InterfaceError;case 11:f=v(l.result);p=["key","policy","Signature","OSSAccessKeyId"].reduce((function(e,t){e[t]=f[t];return e}),{});d={"X-OSS-server-side-encrpytion":"AES256"};if(t.extension){y=u.a.getType(t.extension);d["Content-Type"]=y}s["Cache-Control"]="max-age=2592000";f.securityToken&&(s["x-oss-security-token"]=f.securityToken);e.next=19;return this.upload({url:"https://".concat(f.host),formData:Object.assign({success_action_status:200},s,a,p),name:"file",fileName:"file",filePath:t.filePath,fileType:"image",header:d});case 19:e.next=21;return this.reportOSSUpload(f.id,u.a.getType(t.extension));case 21:return e.abrupt("return",{fileUrl:"https://".concat(f.cdnDomain,"/").concat(f.key),filePath:f.key});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOSSUploadOptionsFromPath",value:function(){var e=f(regeneratorRuntime.mark((function e(t,r,n){var o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(o={env:b.PUBLIC}).filename=t.split("/").pop();o.size=n;r&&(o.targetPath=r);(i=this.getEncoder()).setBodyField({method:"serverless.file.resource.generateProximalSign",params:o});e.next=8;return this.transport.request(i);case 8:a=e.sent;return e.abrupt("return",a.body);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"reportOSSUpload",value:function(){var e=f(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.transport.getEncoder();o={id:t};r&&(o.contentType=r);n.setBodyField({method:"serverless.file.resource.report",params:o});e.next=6;return this.transport.request(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"validate",value:function(e,t){var r=new n.Validator;try{r.validate(e,t)}catch(e){throw e}}}]);return r}(n.BaseService)},"@alicloud/mpserverless-core":function(t,r){t.exports=e}})}(r("./node_modules/@alicloud/mpserverless-core/dist/index.js"))},"./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-function-service/dist/index.js":function(e,t,r){e.exports=function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"FunctionService",(function(){return h}));var n=r("@alicloud/mpserverless-core"),o={functionTarget:{type:"string",allowEmpty:!1}};function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}function s(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function d(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&p(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=y(e);if(t){var o=y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}(r);function r(){l(this,r);return t.apply(this,arguments)}!function(e,t,r){t&&f(e.prototype,t)}(r,[{key:"invoke",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,u,"next",e)}function u(e){s(i,n,o,a,u,"throw",e)}a(void 0)}))}}(regeneratorRuntime.mark((function e(t){var r,i,a,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=c.length>1&&void 0!==c[1]?c[1]:{};this.validate(o,{functionTarget:t});if(!("number"==typeof r&&isNaN(r)||null==r)){e.next=4;break}throw new n.bizError.ValidationError;case 4:(i=this.getEncoder()).setBodyField({method:"serverless.function.runtime.invoke",params:{functionTarget:t,functionArgs:r}});e.next=8;return this.transport.request(i);case 8:a=e.sent;return e.abrupt("return",u(u({},a.body),{},{requestId:a.headers["request-id"]}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validate",value:function(e,t){var r=new n.Validator;try{r.validate(e,t)}catch(e){throw e}}}]);return r}(n.BaseService)},"@alicloud/mpserverless-core":function(t,r){t.exports=e}})}(r("./node_modules/@alicloud/mpserverless-core/dist/index.js"))},"./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-proxy-service/dist/index.js":function(e,t,r){e.exports=function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"ProxyService",(function(){return l}));function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function c(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&u(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=s(e);if(t){var o=s(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return c(this,r)}}(r);function r(){i(this,r);return t.apply(this,arguments)}!function(e,t,r){t&&a(e.prototype,t)}(r,[{key:"forward",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function u(e){o(a,n,i,u,c,"next",e)}function c(e){o(a,n,i,u,c,"throw",e)}u(void 0)}))}}(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.getEncoder()).setBodyField({method:t,params:r});e.next=4;return this.transport.request(n);case 4:o=e.sent;return e.abrupt("return",o.body);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]);return r}(r("@alicloud/mpserverless-core").BaseService)},"@alicloud/mpserverless-core":function(t,r){t.exports=e}})}(r("./node_modules/@alicloud/mpserverless-core/dist/index.js"))},"./node_modules/@alicloud/mpserverless-miniapp-core/node_modules/@alicloud/mp-user-service/dist/index.js":function(e,t,r){e.exports=function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"AuthType",(function(){return n}));r.d(t,"UserService",(function(){return g}));var n,o=r("@alicloud/mpserverless-core"),i={options:{type:"object",rule:{authType:{type:"enum",required:!1,values:["anonymous",""]},authProvider:{type:"enum",required:!1,values:["alipay_openapi","wechat_openapi","dingtalk_openapi"]}}}},a={options:{type:"object",required:!1,rule:{authProvider:{type:"enum",required:!1,values:["alipay_openapi","wechat_openapi","dingtalk_openapi"]}}}},u=Object(o.MPServerlessErrorClass)({UnauthorizedError:{code:"UnauthorizedError",message:"未授权错误"}});function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){f(i,n,o,a,u,"next",e)}function u(e){f(i,n,o,a,u,"throw",e)}a(void 0)}))}}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function h(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}!function(e){e.ANONYMOUS="anonymous";e.DEFAULT=""}(n||(n={}));var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&y(e,t)}(r,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var o=v(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return h(this,r)}}(r);function r(e,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);b(m(i=t.call(this,e)),"pendingRequest",void 0);b(m(i),"scope","auth_base");b(m(i),"appId",void 0);b(m(i),"appSecret",void 0);b(m(i),"isvAppId",void 0);b(m(i),"ua",void 0);b(m(i),"authorizeOptions",void 0);b(m(i),"accessToken",void 0);b(m(i),"getAuthCode",void 0);b(m(i),"httpRequest",void 0);b(m(i),"currentAuthType",void 0);Object(o.assert)(n.getAuthCode,"[UserService]初始化时缺少 getAuthCode 参数");Object(o.assert)(n.request,"[UserService]初始化时缺少 request 参数");Object(o.assert)(n.appId,"[UserService]初始化时缺少 appId 参数");Object(o.assert)(n.appSecret,"[UserService]初始化时缺少 appSecret 参数");i.getAuthCode=n.getAuthCode;i.httpRequest=n.request;i.appId=n.appId;i.appSecret=n.appSecret;i.isvAppId=n.isvAppId;i.ua=n.ua;return i}!function(e,t,r){t&&d(e.prototype,t)}(r,[{key:"authorize",value:function(){var e=p(regeneratorRuntime.mark((function e(){var t,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.length>0&&void 0!==r[0]?r[0]:{authType:n.DEFAULT,authProvider:"alipay_openapi"};this.validate(i,{options:t});if(t.authType!==n.ANONYMOUS){e.next=10;break}e.next=5;return this.anonymousAuthorizeHandler(t);case 5:if(!this.accessToken){e.next=7;break}return e.abrupt("return",{success:!0});case 7:return e.abrupt("return",{success:!1});case 10:if(this.accessToken&&(!this.accessToken||this.currentAuthType===t.authType)){e.next=16;break}e.next=13;return this.authorizeHandler(t);case 13:if(!this.accessToken){e.next=15;break}return e.abrupt("return",{success:!0});case 15:return e.abrupt("return",{success:!1});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInfo",value:function(){var e=p(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.validate(a,{options:t});r=this.getEncoder();n={};this.authorizeOptions&&(n=l({},this.authorizeOptions));t&&(n=l({},t));this.currentAuthType&&(n={authType:this.currentAuthType});r.setBodyField({method:"serverless.auth.user.getProfileInfo",params:n});e.next=9;return this.transport.request(r);case 9:o=e.sent;return e.abrupt("return",o.body);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setRequestToken",value:function(){var e=p(regeneratorRuntime.mark((function e(t){var r,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o.length>1&&void 0!==o[1]&&o[1];if(!this.pendingRequest){e.next=5;break}this.transport.logger.info("[UserService]pendingRequest...");e.next=5;return this.pendingRequest;case 5:if(this.accessToken){e.next=7;break}throw new u.UnauthorizedError("[UserService]未进行用户授权，请先手动调用三方授权或匿名授权方法");case 7:if(!r||!this.authorizeOptions){e.next=16;break}this.transport.logger.info("getAccessToken: start");if(this.authorizeOptions.authType!==n.ANONYMOUS){e.next=14;break}e.next=12;return this.anonymousAuthorizeHandler(this.authorizeOptions);case 12:e.next=16;break;case 14:e.next=16;return this.authorizeHandler(this.authorizeOptions);case 16:t.setBodyField({token:this.accessToken});t.sign(this.appSecret);t.setBaseHeaders({"Content-Type":"application/json","x-basement-token":this.accessToken});return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authorizeHandler",value:function(){var e=p(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.pendingRequest=this.getAuthCode({scopes:this.scope}).then((function(e){r.transport.logger.info("[UserService]Request authcode is ".concat(e.body.authCode," "));return e.body.authCode})).then((function(e){var n=r.getEncoder();n.setBodyField({method:"serverless.auth.user.authorize",params:{authProvider:t.authProvider||"alipay_openapi",clientIdentifier:r.appId,authCode:e,isvAppId:r.isvAppId}});n.sign(r.appSecret);n.setBaseHeaders({"Content-Type":"application/json"});r.ua&&n.setBaseHeaders({"x-serverless-ua":r.ua});var o=n.encodeAsHTTPRequestObject({timeout:r.transport.timeoutOption,dataType:"json"});return r.httpRequest(o)})).then((function(e){r.transport.logger.info("[UserService]Request accessToken "+(e.body.success?"success":"failed"));if(e.body&&e.body.result){r.authorizeOptions=t;r.accessToken=e.body.result.accessToken;r.currentAuthType=n.DEFAULT}r.pendingRequest=null;return Promise.resolve(r.accessToken)}));return e.abrupt("return",this.pendingRequest);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"anonymousAuthorizeHandler",value:function(){var e=p(regeneratorRuntime.mark((function e(t){var r,o,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=this.getEncoder()).setBodyField({method:"serverless.auth.user.anonymousAuthorize",params:{clientIdentifier:this.appId,isvAppId:this.isvAppId}});r.sign(this.appSecret);r.setBaseHeaders({"Content-Type":"application/json"});this.ua&&r.setBaseHeaders({"x-serverless-ua":this.ua});o=r.encodeAsHTTPRequestObject({timeout:this.transport.timeoutOption,dataType:"json"});this.pendingRequest=this.httpRequest(o).then((function(e){i.transport.logger.info("[UserService]Request accessToken "+(e.body.success?"success":"failed"));if(e.body&&e.body.result){i.authorizeOptions=t;i.accessToken=e.body.result.accessToken;i.currentAuthType=n.ANONYMOUS}i.pendingRequest=null;return Promise.resolve(i.accessToken)}));return e.abrupt("return",this.pendingRequest);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validate",value:function(e,t){var r=new o.Validator;try{r.validate(e,t)}catch(e){throw e}}}]);return r}(o.BaseService)},"@alicloud/mpserverless-core":function(t,r){t.exports=e}})}(r("./node_modules/@alicloud/mpserverless-core/dist/index.js"))},"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"MPServerless",(function(){return x}));var n,o=r("./node_modules/@alicloud/mpserverless-miniapp-core/dist/index.js"),i=r("./node_modules/@alicloud/mpserverless-core/dist/index.js"),a=Object(i.MPServerlessErrorClass)({UnsupportPlatformError:{code:"UnsupportPlatformError",message:"无支持平台错误"}});function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){r(e);return}u.done?t(c):Promise.resolve(c).then(n,o)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){l(i,n,o,a,u,"next",e)}function u(e){l(i,n,o,a,u,"throw",e)}a(void 0)}))}}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=v(e);if(t){var o=v(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return h(this,r)}}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}!function(e){e.WECHAT="wechat";e.ALIPAY="alipay";e.DINGTALK="dingtalk"}(n||(n={}));var g=function(){return"undefined"!=typeof dd&&dd&&0!==Object.keys(dd).length?n.DINGTALK:"undefined"!=typeof wx&&wx&&0!==Object.keys(wx).length?n.WECHAT:"undefined"!=typeof my&&my&&0!==Object.keys(my).length?n.ALIPAY:void 0},w=function(e){switch(e){case n.ALIPAY:return my.getAuthCode;case n.DINGTALK:return dd.getAuthCode;default:return null}},O=function(e){if("string"==typeof e)return e;switch(g()){case n.ALIPAY:return e.alipay;case n.WECHAT:return e.wechat;case n.DINGTALK:return e.dingtalk;default:throw new a.UnsupportPlatformError("[MPServerless SDK]当前 SDK 并未支持该小程序平台，敬请期待")}},x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&d(e,t)}(r,e);var t=y(r);function r(e,o){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);b(m(i=t.call(this,{request:function(t){g()===n.DINGTALK&&(t.data=JSON.stringify(t.data));t.header=t.header||t.headers;var r=e.request||e.httpRequest;return i.wrap(r)(t)},getAuthCode:function(){var t=f(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=w(g())||e.getAuthCode||e.login;t.next=3;return i.wrap(n)(r);case 3:(o=t.sent).authCode=o.authCode||o.code;return t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),uploadFile:function(t){return i.wrap(e.uploadFile)(t)},getFileUploadInfo:function(t){var r=0,n="";return(e.getFileInfo&&i.wrap(e.getFileInfo)||function(){return new Promise((function(e){return e({size:0})}))})({filePath:t.filePath,apFilePath:t.filePath}).then((function(n){n.size&&(r=n.size);return i.wrap(e.getImageInfo)({src:t.filePath})})).then((function(e){e.type&&(n=e.type);return{fileSize:r,fileExtension:n}})).catch((function(e){throw e}))}},s(s({},o),{},{appId:O(o.appId)}))),"platform",void 0);i.platform=g();return i}!function(e,t,r){t&&p(e.prototype,t);r&&p(e,r)}(r,[{key:"authProvider",get:function(){switch(this.platform){case n.ALIPAY:return"alipay_openapi";case n.WECHAT:return"wechat_openapi";case n.DINGTALK:return"dingtalk_openapi";default:throw new a.UnsupportPlatformError("[MPServerless SDK]当前 SDK 并未支持该小程序平台，敬请期待")}}},{key:"init",value:function(){var e=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&"anonymous"===t.authorType||t&&"anonymous"===t.authType)){e.next=6;break}e.next=3;return this.user.authorize({authType:"anonymous"});case 3:return e.abrupt("return",e.sent);case 6:e.next=8;return this.user.authorize({authProvider:this.authProvider});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"wrap",value:function(e){return function(t){return new Promise((function(r){e(Object.assign(t,{complete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.headers=e.headers||e.header;return r(e)}}))}))}}}]);return r}(o.MPServerlessMiniAppCore);t.default=x}}).MPServerless}));